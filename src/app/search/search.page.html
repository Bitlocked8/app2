<ion-content class="white-content">

  <!-- Mostrar carrito vacÃ­o -->
  <div class="empty-state" *ngIf="carrito.length === 0">
    <p>No has aÃ±adido productos al carrito ðŸ˜¢</p>
    <ion-text color="medium">Explora productos y aÃ±ade lo que mÃ¡s te guste.</ion-text>
  </div>

  <!-- BotÃ³n de procesar pagos solo si hay productos -->
  <ion-button *ngIf="carrito.length > 0" expand="full" color="primary" (click)="abrirModalPagoWrapper()">
    Procesar Pagos
  </ion-button>

  <!-- Lista de productos en carrito -->
  <ion-list class="custom-carrito-list" *ngIf="carrito.length > 0">
    <ion-item *ngFor="let item of carrito" class="carrito-item">
      <ion-card class="cart-card" (click)="abrirModalEnvio(item)">
        <ion-card-header>
          <ion-card-title>{{ item.producto.nombre ?? 'Producto sin nombre' }}</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p>Cantidad: {{ item.cantidad }}</p>
          <p *ngIf="item.observaciones">{{ item.observaciones }}</p>
          <p>Precio: ${{ item.precioTotal | number:'1.2-2' }}</p>
        </ion-card-content>
      </ion-card>
    </ion-item>
  </ion-list>

  <!-- Modal timeline de envÃ­o -->
  <ion-modal [isOpen]="modalEnvioAbierto" (didDismiss)="cerrarModalEnvio()" class="custom-modal">
    <ng-template>
      <div class="modal-container">
        <ion-button (click)="cerrarModalEnvio()" fill="clear" class="close-btn">âœ•</ion-button>

        <div class="modal-content" *ngIf="productoSeleccionado">
          <h2>{{ productoSeleccionado.producto.nombre ?? 'Producto sin nombre' }}</h2>
          <div class="producto-cantidad-total">
            <p class="cantidad">Cantidad: {{ productoSeleccionado.cantidad }}</p>
            <p class="total">Total: ${{ productoSeleccionado.precioTotal | number:'1.2-2' }}</p>
          </div>

          <div class="timeline">
            <div class="step"
              [class.active]="['AÃ±adido','Pago parcial','Pago total','Enviado','Recibido'].includes(productoSeleccionado.estado ?? '')">
              <div class="circle"></div>
              <div class="label">AÃ±adido</div>
            </div>
            <div class="step"
              [class.active]="['Pago parcial','Pago total','Enviado','Recibido'].includes(productoSeleccionado.estado ?? '')">
              <div class="circle"></div>
              <div class="label">Pago parcial</div>
            </div>
            <div class="step"
              [class.active]="['Pago total','Enviado','Recibido'].includes(productoSeleccionado.estado ?? '')">
              <div class="circle"></div>
              <div class="label">Pago total</div>
            </div>
            <div class="step" [class.active]="['Enviado','Recibido'].includes(productoSeleccionado.estado ?? '')">
              <div class="circle"></div>
              <div class="label">Enviado</div>
            </div>
            <div class="step" [class.active]="(productoSeleccionado.estado ?? '') === 'Recibido'">
              <div class="circle"></div>
              <div class="label">Recibido</div>
            </div>
          </div>
        </div>
      </div>
    </ng-template>
  </ion-modal>

  <!-- Modal de Pago -->
  <ion-modal [isOpen]="modalPagoAbierto" (didDismiss)="cerrarModalPago()" class="custom-modal">
    <ng-template>
      <div class="modal-container">
        <ion-button (click)="cerrarModalPago()" fill="clear" class="close-btn">âœ•</ion-button>

        <div class="modal-content" *ngIf="productosSeleccionadosPago.length > 0">
          <h2>Procesar Pago</h2>

          <ion-list>
            <ion-item *ngFor="let item of productosSeleccionadosPago">
              <ion-label>
                {{ item.producto.nombre ?? 'Producto sin nombre' }} - Cantidad: {{ item.cantidad }} - Total: ${{ item.precioTotal | number:'1.2-2' }}
              </ion-label>
              <ion-checkbox slot="start" [(ngModel)]="item.seleccionado"></ion-checkbox>
            </ion-item>
          </ion-list>

          <div class="tipo-pago">
            <ion-button (click)="procesarPago('parcial')" expand="block">Pago Parcial</ion-button>
            <ion-button (click)="procesarPago('total')" expand="block">Pago Total</ion-button>
          </div>
        </div>
      </div>
    </ng-template>
  </ion-modal>

</ion-content>