<ion-content class="ion-padding">
  <!-- Estado vac√≠o -->
  <div *ngIf="compras.length === 0" class="empty-state">
    <p>No hay compras registradas a√∫n.</p>
  </div>

  <!-- Lista de compras -->
  <div *ngFor="let compra of compras" class="timeline-item">
    <ion-item lines="none" (click)="abrirModal(compra)">
      <ion-avatar slot="start">
        <img [src]="compra.imagen" alt="{{ compra.producto }}">
      </ion-avatar>
      <ion-label>
        <h2>{{ compra.producto }}</h2>
        <p>Cantidad: {{ compra.cantidad }} | Precio: ${{ compra.precio }}</p>
        <p>M√©todo: {{ compra.metodoPago }}</p>
        <p class="fecha">{{ compra.fecha | date:'short' }}</p>
      </ion-label>
    </ion-item>
  </div>

  <!-- Modal din√°mico -->
  <ion-modal #modal [initialBreakpoint]="0.25" [breakpoints]="[0, 0.25, 0.5, 0.75, 1]" *ngIf="selectedCompra">
    <ng-template>
      <ion-content class="ion-padding">
        <!-- Header compra -->
        <ion-grid>
          <ion-row>
            <!-- Columna 1: Imagen cuadrada + Nombre -->
            <ion-col size="4" class="ion-text-center">
              <img [src]="selectedCompra.imagen" alt="{{ selectedCompra.producto }}"
                style="width: 100px; height: 100px; object-fit: cover; border-radius: 8px;">
              <h2>{{ selectedCompra.producto }}</h2>
            </ion-col>

            <!-- Columna 2: Detalles -->
            <ion-col size="8">
              <p>Cantidad: {{ selectedCompra.cantidad }}</p>
              <p>Precio: ${{ selectedCompra.precio }}</p>
              <p>M√©todo de pago: {{ selectedCompra.metodoPago }}</p>
              <p>Estado: {{ selectedCompra.estado }}</p>
              <p>Fecha: {{ selectedCompra.fecha | date:'short' }}</p>
            </ion-col>
          </ion-row>
        </ion-grid>



        <!-- Timeline estado -->
        <div class="timeline-vertical">
          <div *ngFor="let estado of getTimeline(selectedCompra!)" class="timeline-step">
            <div class="circle" [class.done]="estado.done"></div>
            <div class="timeline-content">
              <h4>{{ estado.label }}</h4>
              <p>{{ estado.descripcion }}</p>
              <small>üìÖ {{ estado.fecha | date:'short' }}</small>
            </div>
          </div>
        </div>


        <!-- M√©todos de pago -->
        <div *ngIf="selectedCompra.estado === 'carrito' || selectedCompra.estado === 'pendiente'" class="acciones">
          <ion-segment [(ngModel)]="metodoPagoAhora">
            <ion-segment-button value="qr">QR</ion-segment-button>
            <ion-segment-button value="tarjeta">Tarjeta</ion-segment-button>
            <ion-segment-button value="paypal">PayPal</ion-segment-button>
          </ion-segment>

          <!-- Pago con QR -->
          <div *ngIf="metodoPagoAhora === 'qr'" style="text-align:center; margin-top: 16px;">
            <p>Escanea este c√≥digo QR para pagar:</p>
            <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=Pago%20Fake" alt="QR de pago"
              style="margin: 10px auto; display:block;">
            <ion-item>
              <ion-label>Subir comprobante</ion-label>
              <input type="file" accept="image/*" (change)="onComprobanteSubido($event)" />
            </ion-item>
          </div>

          <!-- Pago con tarjeta -->
          <div *ngIf="metodoPagoAhora === 'tarjeta'" class="inputs-custom">
            <ion-label position="stacked">N√∫mero de tarjeta</ion-label>
            <ion-input type="text" placeholder="1234 5678 9012 3456"></ion-input>

            <ion-label position="stacked">Fecha de expiraci√≥n</ion-label>
            <ion-input type="text" maxlength="5" placeholder="MM/AA"></ion-input>

            <ion-label position="stacked">CVV</ion-label>
            <ion-input type="number" maxlength="3" placeholder="123"></ion-input>

            <ion-label>Subir comprobante</ion-label>
            <input type="file" accept="image/*" (change)="onComprobanteSubido($event)" />
          </div>

          <!-- Pago con PayPal -->
          <div *ngIf="metodoPagoAhora === 'paypal'" class="inputs-custom" style="margin-top: 16px;">
            <p><strong>Datos de la empresa para el pago:</strong></p>

            <p>Email PayPal: <span class="highlight">empresa-fake@paypal.com</span></p>
            <p>Nombre: <span class="highlight">Empresa Ejemplo SRL</span></p>

            <p style="margin-top: 10px;">Env√≠e el pago y suba el comprobante.</p>
            <ion-label>Subir comprobante</ion-label>
            <input type="file" accept="image/*" (change)="onComprobanteSubido($event)" />
          </div>

          <!-- Bot√≥n pagar -->
          <ion-button color="success" expand="block" [disabled]="!comprobanteSubido" (click)="pagar(selectedCompra)">
            Pagar ahora
          </ion-button>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>